<!DOCTYPE html><html lang="null"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>那些我不知道的C | ShallWe Talk</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">那些我不知道的C</h1><a id="logo" href="/.">ShallWe Talk</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> Start</i></a><a href="/archives/"><i class="fa fa-archive"> Archiv</i></a><a href="/about/"><i class="fa fa-user"> Über</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">那些我不知道的C</h1><div class="post-meta">Jul 18, 2013<span> | </span><span class="category"><a href="/categories/C语言学习笔记/">C语言学习笔记</a></span></div><div class="post-content"><p>最近在读《C Primer Plus》和《Expert C Programming》，发现用了很久的C有很多从来都不知道的特性（面壁）。。。  </p>
<p>于是在这里整理一下，就当是学习笔记。以下代码亲测通过。<br>编译器为gcc4.7.2  </p>
<p>###关于#include</p>
<p> #include是C预处理器指令，并不是C语言的语句。通常，C编译器在编译前要对源代码做一些准备工作，称为预处理。#符号表明这一行是在编译器接手之前由C预处理器处理的语句。  </p>
 <a id="more"></a>
<p>###关于sizeof与strlen<br>sizeof把用来标志字符串结束的不可见的空字符也计算在内，它计算存储所需的空间大小。  </p>
<p>strlen则计算字符串的长度。  </p>
<p>无论如何，像\b \a之类的不可见字符都会在计算大小时，被算在其中。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">#include &quot;stdio.h&quot;</div><div class="line">#include &quot;string.h&quot;</div><div class="line">#define AAA &quot;A B C\b\a&quot;</div><div class="line">int main()&#123;</div><div class="line">	char buffer[20];</div><div class="line">	printf(&quot;What&apos;s your name?\n&quot;);</div><div class="line">	scanf(&quot;%s&quot;, buffer);</div><div class="line">	printf(&quot;sizeof%s: %d\n&quot;, buffer, sizeof(buffer));</div><div class="line">	printf(&quot;strlen: %d\n&quot;, strlen(buffer));</div><div class="line">	printf(&quot;strlen of another%s: %d\n&quot;, AAA, strlen(AAA));</div><div class="line">	printf(&quot;sizeof of another: %d\n&quot;, sizeof(AAA));</div><div class="line">	return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这段代码的显示结果是</p>
<pre><code>What&apos;s your name?
Carol Z
sizeofCarol: 20
strlen: 5
strlen of anotherA B : 7
sizeof of another: 8
</code></pre><p>可以看到sizeof包括了结尾的’\0’，但strlen没有，但是对于不可见的字符，它们是平等的。请注意这里奇葩的退格符\b。  </p>
<p>由于scanf的特性，它接收到空白符就停止了，所以真正存在buffer里的字符串并不包括“ Z”，这就是为什么做网络实验那个聊天程序的时候，我们不得不用gets（尤其是对于每个单词之间都有空白符的国家的人，聊天只能一个单词一个单词发也太悲吹了）。我们会在后文继续介绍scanf，它在接收特定形式的输入的时候是十分有效的。  </p>
<p>顺便说一句，之前一直以为是一个函数的sizeof在C语言中并不是一个函数而是一个操作符，我们来看看MSDN上关于sizeof的解释：  </p>
<pre><code>The sizeof keyword gives the amount of storage, in bytes,associated with a variable or a type  
 (including aggregate types).  
This keyword returns a value of type size_t.  
</code></pre><p>这样就说清楚了。  </p>
<p>另外，当sizeof的操作数是个变量的时候，可以不需要加括号，如果是个类型名就要加上括号了(所以会让人以为是个函数啊:))。  </p>
<p>###关于用户交互<br>printf与scanf乃一对好机油。<br>printf()函数的作用是打印到缓冲区。  </p>
<p>当满足以下任意一种情况时，才打印到屏幕。<br>1 缓冲区满  2 遇到换行符  3 需要输入  </p>
<p>%d显示float并不会把float转换成int显示，而是显示dirty number。同样，我们也不能期待%f把int转换成float。  </p>
<p>%表示字符显示的位置，后面的修饰符表示显示的格式。  </p>
<p>当被用作printf()的参数时，float被转换成double，所以用%f打印double也完全大丈夫，人家本来就是用来打印double的，看下面这段代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">float n1 = 3.0;</div><div class="line">double n2 = 3.0;</div><div class="line">long n3 = 2000000000;</div><div class="line">long n4 = 1234567890;</div><div class="line">printf(&quot;%ld %ld %ld %ld\n&quot;, n1, n2, n3, n4);</div></pre></td></tr></table></figure><br>由于n1从float被转换成了double，所以第一个%ld只能读到n1的前四个字节，第二个%ld读到n1的后四个字节，然后n2本来就是double，所以同理。n1和n2分完了所有的%ld，n3和n4就悲剧了。  </p>
<p>scanf如果期待读到%d，那么输入为1a的话，是不会把那个a读入的。  </p>
<p>与printf和scanf一样，putchar和getchar也是一对好机油。看名字应该就知道putchar用来打印一个自符，而getchar用来获取一个字符。所以我们尝试：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">putchar(getchar());</div></pre></td></tr></table></figure><br>很有意思，这个语句获取一个输入的字符，然后立即回显。  </p>
<p>###关于_Bool<br>之前一直抱怨C没有bool类型，实在是太冤枉了。C99引入了_Bool表示bool类型。<br>看下面这段代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">#include &quot;stdio.h&quot;</div><div class="line">int main()&#123;</div><div class="line">	_Bool a = 1;</div><div class="line">	printf(&quot;sizeof: %d\n&quot;, sizeof(a));</div><div class="line">	return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure><br>打印如下</p>
<pre><code>sizeof: 1
</code></pre><p>所以bool类型占用1byte, 取值为0或者1，0表示false，1表示true。<br>就算在上面写的是 _Bool a = 2, 然后打印a结果也是1。本来担心是不是2在二进制下是10,会不会打印的时候打出来的是高位的1,然后换了4尝试，结果打印出来还是1。虽然不知道原理是什么（难道是每次只取第1位？还是强制类型转换成了bool？），但是非0的数打印出来都是1，包括负整数。不要挣扎了少年！  </p>
<p>在”循环”那章证实了我之前的想法：所有非零值都被认为是真。  </p>
<p>另外，C99中提供了一个头文件stdbool.h，用bool代替 _Bool，应用true和false代替1和0，当然这些事情我们也可以自己做。  </p>
<p>顺便表达下for(;;)跟while(1)是一样的。  </p>
<p>###关于ANSI C<br>经常在书里看到<a href="http://en.wikipedia.org/wiki/ANSI_C" target="_blank" rel="external">ANSI C</a>怎样怎样，按照C99标准怎样怎样。它们之间是什么关系呢？  </p>
<p>原来，ANSI C是一个叫美国国家标准协会的组织，它制定了C89/C90/C99/C11等一系列标准。  </p>
<p>###关于四舍五入<br>从小学数学老师就教会我们四舍五入啦。不过计算机比较呆萌，你告诉它怎么做它才会怎么做。所以对于浮点数强制变成整数的情况，C99采用了“趋零截尾”的做法。记住名字应该就记住了这个意思：就是向零靠去掉小数部分嘛。比如1.6变成1，-2.9变成-2。所以请务必记住这个名字。来，再念一遍：趋零截尾。  </p>
<p>###关于取模运算符%<br>不要对浮点数进行取模运算。  </p>
<p>取模运算的符号与第一个操作数的符号相同。如果你硬是像我一样尝试了-0%3与0%4的话，你会看到两个结果都是0。  </p>
<p>###关于类型转换<br>表达式中的有符号和无符号的char和short都被自动转换成int。  </p>
<p>在包含两种数据类型的任何运算里，两个值都被转换成两种类型里的较高级别。  </p>
<p>类型级别从高到低排序：long double &gt; double &gt; float &gt; unsigned long long &gt; long long &gt; unsigned long &gt; long &gt; unsigned int &gt; int 当long和int具有相同大小时，unsigned int &gt; long。  </p>
<p>在赋值语句里，计算的最后结果被转换成将要被赋值的那个变量的类型。  </p>
<p>当作为函数的参数传递时，char和short会被转换成int，float会被转换成double。这里留下一个问题吧，据说可以通过函数原型来阻止自动提升的发生，第9章会讲到。  </p>
<p>###关于结束<br>在stdio.h中EOF被定义为-1, 你可以printf(“%d\n”, EOF);打印出来确实是-1。那为什么文件中间有一个-1的时候并不代表文件结束呢？这里carol猜一下应该是因为文件是按照字符流存储的，所谓的文件里的-1代表的应该是’-‘与’1’两个字符才对的吧~  </p>
<p>###关于#pragma<br>《Expert C Programming》上提到了pragma指示符，说是在gcc 1.34的时候是不支持这货的。据说是因为自由软件基金会(FSF)的一个gcc编译器设计者积极抵制这货。然后就拒绝编译程序，使用一段游戏来代替整个程序。虽然比较有意思，但是我的编译器已经看不到这个彩蛋了（那是多久以前的事情啊。。。），十分可惜啊。  </p>
<p>哦，对了，关于#pragma的一些说明可以在<a href="http://baike.baidu.com/view/1451188.htm" target="_blank" rel="external">这里</a>找到，说得还是比较清楚啦。  </p>
<p>###关于switch<br>在switch语句中，语句是从case语句开始执行的。也就是说，从switch到第一个case之间的赋值全部都无效。让我们来看一件有意思的事情：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">#include &quot;stdio.h&quot;</div><div class="line">int main()&#123;</div><div class="line">	int a = 1;</div><div class="line">	switch(a)&#123;</div><div class="line">		int test = 1;</div><div class="line">		case 1: printf(&quot;test%d\n&quot;, test);</div><div class="line">			break;</div><div class="line">		default:</div><div class="line">			printf(&quot;default\n&quot;);</div><div class="line">	&#125;</div><div class="line">	return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure><br>执行的结果是</p>
<pre><code>test-1216802816
</code></pre><p>因为有了之前那段解释，所以这里就比较好说了，因为那句int test = 1根本就没有执行到！不过这里有一个问题，既然没有执行到，那么为什么test不被认为是没有定义的？<br>顺便表示一下case后面跟的只能是常量，就算是const int也不可以，某些方面反应出了const并不真的表示常量。  </p>
<p>###关于malloc<br>malloc用于在堆中申请一块空间，用完之后一定要记得用free释放掉，否则会造成内存的泄漏。嗯~这个大家都知道就不再多说。哦~顺便提一下内存的使用情况可以通过free命令查看。  </p>
<p>其实我想表达的重点呢，是有一个叫calloc的函数。这个函数在返回指针之前会先把分配好的内存的内容都清空为0。多好的函(hai)数(zi)啊。  </p>
<p>尤记得我们在写网络实验的时候，经常出现的代码片段是这样的：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">char* buffer = malloc(1024);</div><div class="line">memcpy(buffer, 0, 1024);</div></pre></td></tr></table></figure><br>其实完全可以改写成：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">char* buffer = calloc(1024, sizeof(char));</div></pre></td></tr></table></figure><br>函数原型：void *calloc(unsigned n, unsigned size)；<br>功能: 在内存的动态存储区中分配n个长度为size的连续空间，自动初始化该内存空间为零，函数返回一个指向分配起始地址的指针；如果分配不成功，返回NULL。  </p>
</div><div class="tags"></div><div class="post-nav"><a href="/2013/07/30/2013-07-30-some-c-doohickey/" class="pre">一些有意思的做法</a><a href="/2013/04/20/2013-04-20-school-management-system-outline/" class="next">软件工程demo运行概述</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Kategorien</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Beijing/">Beijing</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/C语言学习笔记/">C语言学习笔记</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Security/">Security</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spark/">Spark</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Spark/RDD/">RDD</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Spark/RDD/source-code/">source code</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spark/configuration/">configuration</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/blog/">blog</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/coding/">coding</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/coding/compiler/">compiler</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/dp/">dp</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/language/">language</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/language/Japanese/">Japanese</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/language/Japanese/lyric/">lyric</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/leetcode/">leetcode</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/leetcode/HashTable/">HashTable</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/leetcode/Two-Pointers/">Two Pointers</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/leetcode/divide-and-conquer/">divide and conquer</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/leetcode/dp/">dp</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/mapreduce/">mapreduce</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/music/">music</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/music/guitar/">guitar</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/paper/">paper</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/paper/NLP/">NLP</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/paper/scheduler/">scheduler</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming-language/">programming language</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/python/matplotlib/">matplotlib</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/software-engineer/">software engineer</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/software-engineer/API/">API</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/source-code/">source code</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/source-code/JXIO/">JXIO</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/source-code/Spark/">Spark</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/spark/">spark</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/unity/">unity</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/unity/animation/">animation</a></li></ul></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Letzte</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/07/08/2017-07-08-unity-animation/">unity-animation</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/09/2017-04-09-dynamic-resource-allocation/">Dynamic Resource Allocation</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/06/2017-03-06-swprintf/">来聊一聊C++的string</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/13/2016-08-13-beijing/">出去玩-北京</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/31/2016-05-31-running-spark-on-mesos/">Running Spark on Mesos</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/12/2016-04-12-spark-summary/">Spark小结</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/25/2016-03-25-the-number-of-the-increasing-sub-sequences/">一个数组的递增子序列的个数</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/13/2015-12-13-factorial-nonzero-suffix/">求N!的后9位不为0的数</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/09/24/2015-09-24-recent-performance-improvements-in-apache-spark/">Recent Performance Improvements in Apache Spark: SQL, Python, DataFrame, and More</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/08/15/2015-08-15-matplotlib/">Matplotlib整理</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Blogroll</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2017 <a href="/." rel="nofollow">ShallWe Talk.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div><script src="//dn-lbstatics.qbox.me/lbservice/busuanzi/2.0/busuanzi.mini.js"/></script>
<span id="busuanzi_container_site_uv">已经有<span id="busuanzi_value_site_uv"></span>人次访问carolz的小站啦 ( •̀ ω •́ )y</span></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>